<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UA Air Route Visualizer (Demo)</title>
  <!-- DEMO / FICTIONAL VISUALIZATION -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    :root{--bg:#202023;--panel:#151518;--accent:#F20519;--text:#EAEAF0;--muted:#9A9AA3;--glass:rgba(255,255,255,.06)}
    html,body{height:100%;margin:0;font-family:Inter,system-ui;background:var(--bg);color:var(--text)}
    #map{height:100%;width:100%;background:var(--bg)}
    .neon{filter: drop-shadow(0 0 6px var(--accent)) drop-shadow(0 0 16px var(--accent))}
    .pulse{animation:pulse 2.2s ease-in-out infinite}
    @keyframes pulse{0%{opacity:.85}50%{opacity:1}100%{opacity:.85}}
    .bottom{position:fixed;left:0;right:0;bottom:0;z-index:1000;background:linear-gradient(180deg,rgba(32,32,35,0),rgba(32,32,35,.9));backdrop-filter: blur(10px);display:flex;gap:10px;align-items:center;padding:14px 16px}
    .btn{background:var(--glass);border:1px solid rgba(255,255,255,.12);color:var(--text);padding:10px 14px;border-radius:14px;cursor:pointer;font-weight:600;transition:.25s ease}
    .btn:hover{box-shadow: inset 0 0 0 1px var(--accent)}
    .btn.primary{background:linear-gradient(180deg,rgba(242,5,25,.25),rgba(242,5,25,.12));border-color:rgba(242,5,25,.6)}
    .btn.ghost{background:transparent}
    .status{position:fixed;left:14px;top:14px;z-index:1000;background:rgba(21,21,24,.85);padding:10px 14px;border-radius:14px}
    .panel{position:fixed;right:14px;top:14px;z-index:1001;width:340px;background:rgba(21,21,24,.92);border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:14px;display:none}
    .panel h3{margin:4px 0 10px}
    .row{margin-bottom:10px}
    .row label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    .row input,.row select{width:100%;padding:10px 12px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:#1B1B20;color:var(--text)}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .modal{position:fixed;inset:0;z-index:1002;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6)}
    .modal .box{background:#151518;border:1px solid rgba(255,255,255,.1);border-radius:18px;padding:18px;width:320px}
    .leaflet-control-attribution{display:none}
    .route-dot{width:6px;height:6px;border-radius:50%;background:var(--accent)}
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="status" id="status">Готово</div>

  <div class="bottom">
    <select id="filter" class="btn ghost">
      <option value="all">Показать: все</option>
      <option value="shahed">Только шахеды</option>
      <option value="rocket">Только ракеты</option>
    </select>
    <button class="btn ghost" id="previewBtn">Показать маршрут</button>
    <button class="btn" id="helpBtn">Справка</button>
    <div style="flex:1"></div>
    <button class="btn primary" id="adminBtn">Вход администратора</button>
  </div>

  <div class="panel" id="adminPanel">
    <h3>Админ‑панель</h3>
    <div class="row"><label>Тип</label><select id="type"><option value="shahed">Shahed</option><option value="rocket">Rocket</option></select></div>
    <div class="row"><label>Скорость (симуляция)</label><input id="speed" type="number" value="180" /></div>
    <div class="row"><label>Маршрут</label><select id="route"><option value="direct">Прямой</option><option value="curve">Плавный</option><option value="zigzag">Зигзаг</option></select></div>
    <div class="actions">
      <button class="btn primary" id="spawn">Заспавнить</button>
      <button class="btn" id="delete" disabled>Удалить выбранный</button>
      <button class="btn" id="pause">Пауза/Продолжить</button>
      <button class="btn" id="clear">Очистить все</button>
    </div>
    <p style="color:var(--muted);font-size:12px">Клик: старт → цель. Клик по объекту — выбор.</p>
  </div>

  <div class="modal" id="login"><div class="box"><h3>Вход администратора</h3><div class="row"><label>Пароль</label><input id="pass" type="password" /></div><div class="actions"><button class="btn primary" id="loginBtn">Войти</button><button class="btn" id="cancel">Отмена</button></div></div></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const ADMIN_PASSWORD='Ntvf2011';
    const statusEl=document.getElementById('status');
    const setStatus=t=>statusEl.textContent=t;

    const map=L.map('map').setView([49,31],6);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{maxZoom:18}).addTo(map);
    const bounds=L.latLngBounds([44,22],[52.5,41]);map.setMaxBounds(bounds);map.on('drag',()=>map.panInsideBounds(bounds,{animate:false}));

    const adminPanel=document.getElementById('adminPanel');
    const login=document.getElementById('login');

    let spawnMode=false,stage=0,start=null,paused=false;
    const entities=[]; let selected=null;

    function iconFor(type){
      const img=type==='shahed'?'shahed.png':'rocket.png';
      const size=38; // чуть больше
      const html=`<img src="${img}" style="width:${size}px" class="neon pulse"/>`;
      return L.divIcon({html,iconSize:[size,size],className:''});
    }

    function pathBuild(a,b,mode){
      if(mode==='curve'){const m=L.latLng((a.lat+b.lat)/2+.35,(a.lng+b.lng)/2);return [a,m,b];}
      if(mode==='zigzag'){const m1=L.latLng((a.lat+b.lat)/2+.25,(a.lng+b.lng)/2-.35);const m2=L.latLng((a.lat+b.lat)/2-.25,(a.lng+b.lng)/2+.35);return [a,m1,m2,b];}
      return [a,b];
    }

    function animate(ent){
      const tick=90; const mpt=(ent.speed*1000)/(3600*(1000/tick));
      ent.timer=setInterval(()=>{
        if(paused) return;
        const path=ent.path; let i=ent.i;
        if(i>=path.length-1){clearInterval(ent.timer);return;}
        const f=path[i],to=path[i+1]; const d=map.distance(f,to);
        if(d<=mpt){ent.marker.setLatLng(to);ent.i++;}
        else{const r=mpt/d;const lat=f.lat+(to.lat-f.lat)*r;const lng=f.lng+(to.lng-f.lng)*r;ent.marker.setLatLng([lat,lng]);path[i]=L.latLng(lat,lng);} 
      },tick);
    }

    function showRouteFromCurrent(ent){
      if(ent.preview){ent.preview.forEach(d=>map.removeLayer(d));}
      const dots=[];
      const cur=ent.marker.getLatLng();
      const rest=[cur,...ent.path.slice(ent.i+1)];
      rest.forEach(p=>{
        const d=L.marker(p,{icon:L.divIcon({html:'<div class="route-dot neon"></div>',iconSize:[6,6]})}).addTo(map);
        dots.push(d);
      });
      ent.preview=dots;
    }

    map.on('click',e=>{
      if(!spawnMode) return;
      if(stage===0){start=e.latlng;stage=1;setStatus('Выберите цель');}
      else{
        const end=e.latlng; spawnMode=false; stage=0;
        const type=document.getElementById('type').value;
        const speed=Number(document.getElementById('speed').value)|| (type==='rocket'?900:180);
        const route=document.getElementById('route').value;
        const path=pathBuild(start,end,route);
        const marker=L.marker(start,{icon:iconFor(type)}).addTo(map);
        marker.bindPopup(type==='shahed'?'Шахед':'Ракета');
        const ent={id:crypto.randomUUID(),type,marker,path,speed,i:0,preview:[]};
        marker.on('click',()=>{selected=ent;document.getElementById('delete').disabled=false;marker.openPopup();});
        entities.push(ent); animate(ent); setStatus('Добавлено');
      }
    });

    document.getElementById('adminBtn').onclick=()=>login.style.display='flex';
    document.getElementById('cancel').onclick=()=>login.style.display='none';
    document.getElementById('loginBtn').onclick=()=>{if(document.getElementById('pass').value===ADMIN_PASSWORD){adminPanel.style.display='block';login.style.display='none';setStatus('Админ активен');} else alert('Неверный пароль');};
    document.getElementById('spawn').onclick=()=>{spawnMode=true;stage=0;setStatus('Кликните старт');};
    document.getElementById('pause').onclick=()=>{paused=!paused;setStatus(paused?'Пауза':'Продолжено');};
    document.getElementById('clear').onclick=()=>{entities.forEach(e=>{clearInterval(e.timer);map.removeLayer(e.marker);});entities.length=0;setStatus('Очищено');};
    document.getElementById('delete').onclick=()=>{if(!selected) return; clearInterval(selected.timer); map.removeLayer(selected.marker); selected.preview?.forEach(d=>map.removeLayer(d)); const i=entities.indexOf(selected); if(i>-1) entities.splice(i,1); selected=null; document.getElementById('delete').disabled=true; setStatus('Удалено');};

    document.getElementById('previewBtn').onclick=()=>{
      if(!entities.length){setStatus('Нет объектов');return;}
      entities.forEach(e=>showRouteFromCurrent(e)); setStatus('Показан маршрут');
    };

    document.getElementById('filter').onchange=e=>{
      const v=e.target.value;
      entities.forEach(ent=>{
        const show=v==='all'||ent.type===v;
        if(show) map.addLayer(ent.marker); else map.removeLayer(ent.marker);
      });
    };

    document.getElementById('helpBtn').onclick=()=>alert('Демо‑визуализация.\nКлик по объекту показывает тип.\nАдмин может удалять объекты.');
  </script>
</body>
</html>
