<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Чернігівська область — Тривоги</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #111;
            color: #fff;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        #map-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #1a1a1a;
            overflow: hidden;
        }

        #map {
            width: 70%;
            height: 70%;
        }

        #menu {
            background: #222;
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 20px;
            border-top: 2px solid #333;
        }

        button {
            background: #444;
            color: #fff;
            border: none;
            padding: 12px 18px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
        }
        button:hover { background: #666; }

        /* Модалки */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #222;
            padding: 20px;
            width: 320px;
            border-radius: 10px;
            text-align: center;
        }

        select {
            width: 100%;
            margin-top: 10px;
            padding: 10px;
            background: #333;
            color: white;
            border-radius: 6px;
            border: 1px solid #444;
        }
    </style>
</head>
<body>

<div id="map-container">
    <object id="map" type="image/svg+xml" data="chernihiv_map.svg"></object>
</div>

<div id="menu">
    <button onclick="openSettings()">Налаштування</button>
    <button id="adminPanelBtn" style="display:none;" onclick="openAlarmPanel()">Панель тривог</button>
</div>

<!-- Модалка настроек -->
<div class="modal" id="settingsModal">
    <div class="modal-content">
        <h3>Налаштування</h3>
        <button onclick="openAdminLogin()">Вхід організатора</button>
        <br><br>
        <button onclick="closeAll()">Закрити</button>
    </div>
</div>

<!-- Модалка логина -->
<div class="modal" id="adminLoginModal">
    <div class="modal-content">
        <h3>Пароль організатора</h3>
        <input type="password" id="adminPassword" placeholder="Введіть пароль"
               style="padding:10px;width:90%;background:#333;color:white;border:none;border-radius:6px;">
        <br><br>
        <button onclick="checkPassword()">Увійти</button>
        <br><br>
        <button onclick="closeAll()">Закрити</button>
    </div>
</div>

<!-- Панель тревог -->
<div class="modal" id="alarmPanelModal">
    <div class="modal-content">
        <h3>Оголошення тривоги</h3>

        <label>Тип тривоги:</label>
        <select id="alarmType">
            <option value="air">Повітряна тривога</option>
            <option value="artillery">Артобстріл</option>
            <option value="street">Вуличні бої</option>
            <option value="chemical">Хімічна загроза</option>
            <option value="radiation">Радіація</option>
        </select>

        <label>Район:</label>
        <select id="regionSelect">
            <option value="novhorod_rayon">Новгород-Сіверський район</option>
            <option value="chernihiv_rayon">Чернігівський район</option>
            <option value="chernihiv_city">м. Чернігів</option>
            <option value="koryukivka_rayon">Корюківський район</option>
            <option value="nizhyn_rayon">Ніжинський район</option>
            <option value="pryluky_rayon">Прилуцький район</option>
        </select>

        <br><br>
        <button onclick="declareAlarm()">Тривога по району</button>
        <br><br>
        <button onclick="declareAll()">Тривога по всій області</button>
        <br><br>

        <button onclick="clearOne()">Відбій по району</button>
        <br><br>
        <button onclick="clearAll()">Відбій по всій області</button>

        <br><br>
        <button onclick="closeAll()">Закрити</button>
    </div>
</div>

<script>
let svgDoc = null;
let originalColors = {};

function tryLoadSVG() {
    const mapObj = document.getElementById("map");
    if (mapObj.contentDocument) {
        svgDoc = mapObj.contentDocument;
        saveOriginalColors();
        return true;
    }
    return false;
}

document.getElementById("map").addEventListener("load", () => {
    setTimeout(() => {
        let tries = 0;
        const timer = setInterval(() => {
            tries++;
            if (tryLoadSVG()) clearInterval(timer);
            if (tries > 20) clearInterval(timer);
        }, 200);
    }, 200);
});

function openSettings() { document.getElementById("settingsModal").style.display = "flex"; }
function openAdminLogin() { document.getElementById("adminLoginModal").style.display = "flex"; }
function openAlarmPanel() { document.getElementById("alarmPanelModal").style.display = "flex"; }
function closeAll() {
    document.getElementById("settingsModal").style.display = "none";
    document.getElementById("adminLoginModal").style.display = "none";
    document.getElementById("alarmPanelModal").style.display = "none";
}

function checkPassword() {
    let input = document.getElementById("adminPassword").value;
    if (input === "Ntvf2011") {
        alert("Вхід успішний!");
        document.getElementById("adminPanelBtn").style.display = "inline-block";
        closeAll();
    } else {
        alert("Невірний пароль!");
    }
}

function getAlarmColor(type) {
    switch(type) {
        case "air": return "#ff0000";
        case "artillery": return "#ff8c00";
        case "street": return "#ffff00";
        case "chemical": return "#00ff00";
        case "radiation": return "#8000ff";
        default: return "#555";
    }
}

function saveOriginalColors() {
    const ids = [
        "novhorod_rayon",
        "chernihiv_rayon",
        "chernihiv_city",
        "koryukivka_rayon",
        "nizhyn_rayon",
        "pryluky_rayon"
    ];

    ids.forEach(id => {
        let el = svgDoc.getElementById(id);
        if (el) {
            originalColors[id] = el.style.fill || el.getAttribute("fill") || "#cccccc";
        }
    });
}

function declareAlarm() {
    if (!svgDoc) return alert("Карта ще не завантажилась!");

    let type = document.getElementById("alarmType").value;
    let region = document.getElementById("regionSelect").value;
    let area = svgDoc.getElementById(region);

    if (!area) return alert("❌ В SVG немає району!");

    area.style.fill = getAlarmColor(type);
    alert("Тривога по району встановлена!");
}

function declareAll() {
    if (!svgDoc) return alert("Карта ще не завантажилась!");

    let type = document.getElementById("alarmType").value;
    let color = getAlarmColor(type);

    Object.keys(originalColors).forEach(id => {
        let area = svgDoc.getElementById(id);
        if (area) area.style.fill = color;
    });

    alert("Тривога по всій області встановлена!");
}

function clearOne() {
    if (!svgDoc) return alert("Карта ще не завантажилась!");

    let region = document.getElementById("regionSelect").value;
    let area = svgDoc.getElementById(region);

    if (!area) return alert("❌ В SVG немає району!");

    area.style.fill = originalColors[region];
    alert("Відбій по району виконано!");
}

function clearAll() {
    if (!svgDoc) return alert("Карта ще не завантажилась!");

    Object.keys(originalColors).forEach(id => {
        let area = svgDoc.getElementById(id);
        if (area) area.style.fill = originalColors[id];
    });

    alert("Відбій по всій області виконано!");
}
</script>

</body>
</html>
